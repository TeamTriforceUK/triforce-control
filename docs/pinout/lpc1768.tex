\usepackage{circuitikz}

\newlength{\ResUp} \newlength{\ResDown}
\newlength{\ResLeft} \newlength{\ResRight}

% ************************** multipoles *****************************

\ctikzset{multipoles/.is family}
\ctikzset{multipoles/pin spacing/.initial = 5mm} % default value

\pgfkeys{/tikz/pin spacing/.initial = 0mm}
\pgfkeys{/tikz/pin spacing/.default = 0mm}

\newlength{\IClen}  % scale factor
\newcommand{\pinsize}{\ifdim\IClen<3.5mm \tiny \else \scriptsize \fi}

\newcommand{\boardwidth}{26}
\newcommand{\boardheight}{54}

\newcommand{\pinwidth}{0.8}
\newcommand{\pinheight}{0.4}

\newcommand{\pinxleft}{-9.8}
\newcommand{\pinxright}{9.8}

\newcommand{\textxleft}{-9.4}
\newcommand{\textxright}{9.4}

\newcommand{\Compass}% define anchors for compass points
{\anchor{north east}{\northeast}
\anchor{south west}{\southwest}
\anchor{north}{\pgfextracty{\ResUp}{\northeast}\pgfpoint{0cm}{\ResUp}}
\anchor{north west}{\pgfextracty{\ResUp}{\northeast}\pgfextractx{\ResLeft}{\southwest}\pgfpoint{\ResLeft}{\ResUp}}
\anchor{west}{\pgfextractx{\ResLeft}{\sosuthwest}\pgfpoint{\ResLeft}{0cm}}
\anchor{south}{\pgfextracty{\ResDown}{\southwest}\pgfpoint{0cm}{\ResDown}}
\anchor{south east}{\pgfextracty{\ResDown}{\southwest}\pgfextractx{\ResRight}{\northeast}\pgfpoint{\ResRight}{\ResDown}}
\anchor{east}{\pgfextractx{\ResRight}{\northeast}\pgfpoint{\ResRight}{0cm}}}

% ***************************** LPC1768 Board Layout *********************************
% anchors p1 - p21

\pgfdeclareshape{lpc1768}{
\anchor{center}{\pgfpointorigin} % within the node, (0,0) is the center

\anchor{text}% this is used to center the text in the node
 {\pgfpoint{-.5\wd\pgfnodeparttextbox}{-.5\ht\pgfnodeparttextbox}}

\savedmacro{\resize}{   % called automatically
 \setlength{\IClen}{\pgfkeysvalueof{/tikz/pin spacing}} % from node[]
 \ifdim\IClen=0mm \setlength{\IClen}
  {\pgfkeysvalueof{/tikz/circuitikz/multipoles/pin spacing}} \fi    % from \ctikzset{}
}
\savedanchor\icpinla{\pgfpoint{-\boardwidth/2\IClen}{7.5\IClen}}  % pin 1
\anchor{p1}{\icpinla}
\savedanchor\icpinlb{\pgfpoint{-\boardwidth/2\IClen}{6.5\IClen}}  % pin 2
\anchor{p2}{\icpinlb}
\savedanchor\icpinlc{\pgfpoint{-\boardwidth/2\IClen}{5.5\IClen}}  % pin 3
\anchor{p3}{\icpinlc}
\savedanchor\icpinld{\pgfpoint{-\boardwidth/2\IClen}{4.5\IClen}}  % pin 4
\anchor{p4}{\icpinld}
\savedanchor\icpinle{\pgfpoint{-\boardwidth/2\IClen}{3.5\IClen}}  % pin 5
\anchor{p5}{\icpinle}
\savedanchor\icpinlf{\pgfpoint{-\boardwidth/2\IClen}{2.5\IClen}}  % pin 6
\anchor{p6}{\icpinlf}
\savedanchor\icpinlg{\pgfpoint{-\boardwidth/2\IClen}{1.5\IClen}}  % pin 7
\anchor{p7}{\icpinlg}
\savedanchor\icpinlh{\pgfpoint{-\boardwidth/2\IClen}{0.5\IClen}}  % pin 8
\anchor{p8}{\icpinlh}
\savedanchor\icpinli{\pgfpoint{-\boardwidth/2\IClen}{-0.5\IClen}}  % pin 9
\anchor{p9}{\icpinli}
\savedanchor\icpinlj{\pgfpoint{-\boardwidth/2\IClen}{-1.5\IClen}}  % pin 10
\anchor{p10}{\icpinlj}
\savedanchor\icpinlk{\pgfpoint{-\boardwidth/2\IClen}{-2.5\IClen}}  % pin 11
\anchor{p11}{\icpinlk}
\savedanchor\icpinll{\pgfpoint{-\boardwidth/2\IClen}{-3.5\IClen}}  % pin 12
\anchor{p12}{\icpinll}
\savedanchor\icpinlm{\pgfpoint{-\boardwidth/2\IClen}{-4.5\IClen}}  % pin 13
\anchor{p13}{\icpinlm}
\savedanchor\icpinln{\pgfpoint{-\boardwidth/2\IClen}{-5.5\IClen}}  % pin 14
\anchor{p14}{\icpinln}
\savedanchor\icpinlo{\pgfpoint{-\boardwidth/2\IClen}{-6.5\IClen}}  % pin 15
\anchor{p15}{\icpinlo}
\savedanchor\icpinlp{\pgfpoint{-\boardwidth/2\IClen}{-7.5\IClen}}  % pin 16
\anchor{p16}{\icpinlp}
\savedanchor\icpinba{\pgfpoint{-\boardwidth/2\IClen}{-8.5\IClen}} % pin 17
\anchor{p17}{\icpinba}
\savedanchor\icpinbb{\pgfpoint{-\boardwidth/2\IClen}{-9.5\IClen}} % pin 18
\anchor{p18}{\icpinbb}
\savedanchor\icpinbc{\pgfpoint{-\boardwidth/2\IClen}{-10.5\IClen}} % pin 19
\anchor{p19}{\icpinbc}
\savedanchor\icpinbd{\pgfpoint{-\boardwidth/2\IClen}{-11.5\IClen}} % pin 20
\anchor{p20}{\icpinbd}
\savedanchor\icpinbe{\pgfpoint{-3.5\IClen}{-12.5\IClen}} % pin 21
\anchor{p21}{\icpinbe}

\savedanchor{\northeast}{\pgfpoint{9.8\IClen}{9.8\IClen}}
\savedanchor{\southwest}{\pgfpoint{-9.8\IClen}{-9.8\IClen}}
\Compass% standard anchors

\foregroundpath{ % border and pin numbers are drawn here
 \pgfsetlinewidth{0.1\IClen}
 \pgfpathmoveto{\pgfpoint{-9\IClen}{8.4\IClen}}
 \pgfpathlineto{\pgfpoint{-9\IClen}{-12.4\IClen}}
 \pgfpathlineto{\pgfpoint{9\IClen}{-12.4\IClen}}
 \pgfpathlineto{\pgfpoint{9\IClen}{8.4\IClen}}

 \pgfpathclose
 \pgfusepath{draw}  %draw border
 \pgfsetlinewidth{0.06\IClen}
 \pgfpathcircle{\pgfpoint{-7.8\IClen}{7.8\IClen}}{0.3\IClen}

 % LHS pins
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{7.2\IClen}}{\pgfpoint{-9\IClen}{7.8\IClen}} % pin 1
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{6.2\IClen}}{\pgfpoint{-9\IClen}{6.8\IClen}} % pin 2
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{5.2\IClen}}{\pgfpoint{-9\IClen}{5.8\IClen}} % pin 3
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{4.2\IClen}}{\pgfpoint{-9\IClen}{4.8\IClen}} % pin 4
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{3.2\IClen}}{\pgfpoint{-9\IClen}{3.8\IClen}} % pin 5
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{2.2\IClen}}{\pgfpoint{-9\IClen}{2.8\IClen}} % pin 6
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{1.2\IClen}}{\pgfpoint{-9\IClen}{1.8\IClen}} % pin 7
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{0.2\IClen}}{\pgfpoint{-9\IClen}{0.8\IClen}} % pin 8
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-0.2\IClen}}{\pgfpoint{-9\IClen}{-0.8\IClen}} % pin 9
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-1.2\IClen}}{\pgfpoint{-9\IClen}{-1.8\IClen}} % pin 10
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-2.2\IClen}}{\pgfpoint{-9\IClen}{-2.8\IClen}} % pin 11
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-3.2\IClen}}{\pgfpoint{-9\IClen}{-3.8\IClen}} % pin 12
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-4.2\IClen}}{\pgfpoint{-9\IClen}{-4.8\IClen}} % pin 13
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-5.2\IClen}}{\pgfpoint{-9\IClen}{-5.8\IClen}} % pin 14
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-6.2\IClen}}{\pgfpoint{-9\IClen}{-6.8\IClen}} % pin 15
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-7.2\IClen}}{\pgfpoint{-9\IClen}{-7.8\IClen}} % pin 16
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-8.2\IClen}}{\pgfpoint{-9\IClen}{-8.8\IClen}} % pin 17
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-9.2\IClen}}{\pgfpoint{-9\IClen}{\pinxleft \IClen}} % pin 18
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-10.2\IClen}}{\pgfpoint{-9\IClen}{-10.8\IClen}} % pin 19
 \pgfpathrectanglecorners{\pgfpoint{\pinxleft \IClen}{-11.2\IClen}}{\pgfpoint{-9\IClen}{-11.8\IClen}} % pin 20

 % RHS Pins
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{7.2\IClen}}{\pgfpoint{9\IClen}{7.8\IClen}} % pin 1
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{6.2\IClen}}{\pgfpoint{9\IClen}{6.8\IClen}} % pin 2
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{5.2\IClen}}{\pgfpoint{9\IClen}{5.8\IClen}} % pin 3
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{4.2\IClen}}{\pgfpoint{9\IClen}{4.8\IClen}} % pin 4
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{3.2\IClen}}{\pgfpoint{9\IClen}{3.8\IClen}} % pin 5
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{2.2\IClen}}{\pgfpoint{9\IClen}{2.8\IClen}} % pin 6
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{1.2\IClen}}{\pgfpoint{9\IClen}{1.8\IClen}} % pin 7
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{0.2\IClen}}{\pgfpoint{9\IClen}{0.8\IClen}} % pin 8
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-0.2\IClen}}{\pgfpoint{9\IClen}{-0.8\IClen}} % pin 9
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-1.2\IClen}}{\pgfpoint{9\IClen}{-1.8\IClen}} % pin 10
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-2.2\IClen}}{\pgfpoint{9\IClen}{-2.8\IClen}} % pin 11
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-3.2\IClen}}{\pgfpoint{9\IClen}{-3.8\IClen}} % pin 12
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-4.2\IClen}}{\pgfpoint{9\IClen}{-4.8\IClen}} % pin 13
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-5.2\IClen}}{\pgfpoint{9\IClen}{-5.8\IClen}} % pin 14
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-6.2\IClen}}{\pgfpoint{9\IClen}{-6.8\IClen}} % pin 15
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-7.2\IClen}}{\pgfpoint{9\IClen}{-7.8\IClen}} % pin 16
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-8.2\IClen}}{\pgfpoint{9\IClen}{-8.8\IClen}} % pin 17
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-9.2\IClen}}{\pgfpoint{9\IClen}{-9.8\IClen}} % pin 18
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-10.2\IClen}}{\pgfpoint{9\IClen}{-10.8\IClen}} % pin 19
 \pgfpathrectanglecorners{\pgfpoint{\pinxright \IClen}{-11.2\IClen}}{\pgfpoint{9\IClen}{-11.8\IClen}} % pin 20
 \pgfusepath{draw}  %draw pins

 % LHS
 \pgftext[at=\pgfpoint{\textxleft \IClen}{7.5\IClen}]{\pinsize 1}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{6.5\IClen}]{\pinsize 2}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{5.5\IClen}]{\pinsize 3}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{4.5\IClen}]{\pinsize 4}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{3.5\IClen}]{\pinsize 5}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{2.5\IClen}]{\pinsize 6}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{1.5\IClen}]{\pinsize 7}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{0.5\IClen}]{\pinsize 8}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-0.5\IClen}]{\pinsize 9}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-1.5\IClen}]{\pinsize 10}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-2.5\IClen}]{\pinsize 11}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-3.5\IClen}]{\pinsize 12}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-4.5\IClen}]{\pinsize 13}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-5.5\IClen}]{\pinsize 14}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-6.5\IClen}]{\pinsize 15}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-7.5\IClen}]{\pinsize 16}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-8.5\IClen}]{\pinsize 17}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-9.5\IClen}]{\pinsize 18}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-10.5\IClen}]{\pinsize 19}
 \pgftext[at=\pgfpoint{\textxleft \IClen}{-11.5\IClen}]{\pinsize 20}

 % RHS
 \pgftext[at=\pgfpoint{\textxright \IClen}{7.5\IClen}]{\pinsize VOUT}
 \pgftext[at=\pgfpoint{\textxright \IClen}{6.5\IClen}]{\pinsize VU}
 \pgftext[at=\pgfpoint{\textxright \IClen}{5.5\IClen}]{\pinsize IF-}
 \pgftext[at=\pgfpoint{\textxright \IClen}{4.5\IClen}]{\pinsize IF+}
 \pgftext[at=\pgfpoint{\textxright \IClen}{3.5\IClen}]{\pinsize RD-}
 \pgftext[at=\pgfpoint{\textxright \IClen}{2.5\IClen}]{\pinsize RD+}
 \pgftext[at=\pgfpoint{\textxright \IClen}{1.5\IClen}]{\pinsize TD-}
 \pgftext[at=\pgfpoint{\textxright \IClen}{0.5\IClen}]{\pinsize TD+}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-0.5\IClen}]{\pinsize D-}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-1.5\IClen}]{\pinsize D+}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-2.5\IClen}]{\pinsize 30}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-3.5\IClen}]{\pinsize 29}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-4.5\IClen}]{\pinsize 28}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-5.5\IClen}]{\pinsize 27}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-6.5\IClen}]{\pinsize 26}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-7.5\IClen}]{\pinsize 25}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-8.5\IClen}]{\pinsize 24}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-9.5\IClen}]{\pinsize 23}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-10.5\IClen}]{\pinsize 22}
 \pgftext[at=\pgfpoint{\textxright \IClen}{-11.5\IClen}]{\pinsize 21}
}}
